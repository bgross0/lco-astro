---
import Icon from '../common/Icon.astro';
import navigation from '../../content/homepage/navigation.json';
import settings from '../../data/settings.json';

export interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

// Use navigation items from JSON, sorted by order
const navItems = navigation.mainMenu.sort((a, b) => a.order - b.order);

const isActive = (href: string) => {
  if (href === '/') {
    return currentPath === href;
  }
  return currentPath.startsWith(href);
};

// Use operations number for the navbar, just the number without label
const phoneNumber = "612-655-0648";
const phoneLink = `tel:${phoneNumber.replace(/-/g, '')}`;
---

<nav class="nav" aria-label="Main navigation">
  <ul class="nav__list">
    {navItems.map((item) => (
      item.dropdown ? (
        <li class="nav__item nav__item--dropdown">
          <button class="nav__link nav__dropdown-trigger">
            {item.label}
            <svg class="nav__dropdown-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <ul class="nav__dropdown">
            {item.dropdown.map((subItem) => (
              <li>
                <a 
                  href={subItem.href} 
                  class={`nav__dropdown-link ${isActive(subItem.href) ? 'nav__dropdown-link--active' : ''}`}
                >
                  {subItem.label}
                </a>
              </li>
            ))}
          </ul>
        </li>
      ) : (
        <li class="nav__item">
          <a 
            href={item.href} 
            class={`nav__link ${isActive(item.href) ? 'nav__link--active' : ''}`}
            aria-current={isActive(item.href) ? 'page' : undefined}
          >
            {item.label}
          </a>
        </li>
      )
    ))}
    <li class="nav__item nav__item--phone">
      <a href={phoneLink} class="nav__phone-btn">
        <Icon name="phone" size={18} />
        <span>{phoneNumber}</span>
      </a>
    </li>
  </ul>
</nav>

<style>
  .nav {
    display: none;
  }
  
  @media (min-width: 1024px) {
    .nav {
      display: block;
    }
    
    .nav__list {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    .nav__item {
      margin: 0;
    }
    
    .nav__link {
      display: block;
      padding: var(--space-2) var(--space-3);
      font-family: var(--font-body);
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--neutral-dark);
      text-decoration: none;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      position: relative;
      white-space: nowrap;
    }
    
    .nav__link:hover {
      color: var(--primary);
      background-color: rgba(74, 144, 226, 0.1);
      text-decoration: none;
    }
    
    .nav__link--active {
      color: var(--primary);
      font-weight: 600;
    }
    
    .nav__link--active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: var(--space-4);
      right: var(--space-4);
      height: 3px;
      background-color: var(--primary);
      border-radius: var(--radius-sm);
    }
    
    /* Dropdown styles */
    .nav__item--dropdown {
      position: relative;
    }
    
    .nav__dropdown-trigger {
      display: flex;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }
    
    .nav__dropdown-icon {
      transition: transform var(--transition-fast);
    }
    
    .nav__item--dropdown:hover .nav__dropdown-icon {
      transform: rotate(180deg);
    }
    
    .nav__dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 240px;
      background: var(--white);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: var(--space-2) 0;
      margin-top: var(--space-2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all var(--transition-fast);
      list-style: none;
      z-index: 100;
    }
    
    .nav__item--dropdown:hover .nav__dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .nav__dropdown-link {
      display: block;
      padding: var(--space-2) var(--space-4);
      color: var(--neutral-dark);
      text-decoration: none;
      font-size: var(--text-sm);
      white-space: nowrap;
      transition: all var(--transition-fast);
    }
    
    .nav__dropdown-link:hover {
      background-color: rgba(74, 144, 226, 0.1);
      color: var(--primary);
    }
    
    .nav__dropdown-link--active {
      color: var(--primary);
      font-weight: 600;
    }
    
    /* Phone button */
    .nav__item--phone {
      margin-left: var(--space-4);
    }
    
    .nav__phone-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      background-color: var(--primary);
      color: var(--white);
      font-weight: 600;
      text-decoration: none;
      border-radius: var(--radius-full);
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .nav__phone-btn:hover {
      background-color: var(--white);
      color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      text-decoration: none;
    }
    
    .nav__phone-btn span {
      font-size: var(--text-sm);
      white-space: nowrap;
      display: inline-block;
    }
  }
  
  @media (min-width: 1280px) {
    .nav__link {
      font-size: var(--text-base);
      padding: var(--space-2) var(--space-4);
    }
    
    .nav__phone-btn {
      padding: var(--space-2) var(--space-4);
    }
    
    .nav__phone-btn span {
      font-size: var(--text-base);
    }
  }
</style>