"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[168],{125:(e,t,a)=>{a.d(t,{$P:()=>n,Vg:()=>s,uE:()=>o});var r=a(636);class i extends Error{constructor(e,t,a){super(e),this.status=t,this.data=a,this.name="ApiError"}}async function o(e,t){let{params:a,retries:o=3,retryDelay:s=1e3,...n}=t||{},l=new URL("".concat("https://lco.axsys.app").concat(e));a&&Object.entries(a).forEach(e=>{let[t,a]=e;null!=a&&l.searchParams.append(t,String(a))});let c={"Content-Type":"application/json",...n.headers||{}},d=r.env.ODOO_API_KEY;d&&(c["X-API-Key"]=d);let u=null;for(let e=0;e<o;e++)try{let t=await fetch(l.toString(),{...n,headers:c}),a=await t.json();if(!t.ok){if(t.status>=400&&t.status<500)throw new i(a.error||"API Error: ".concat(t.statusText),t.status,a);if(t.status>=500&&(u=new i(a.error||"Server Error: ".concat(t.statusText),t.status,a),e<o-1)){await new Promise(t=>setTimeout(t,s*Math.pow(2,e)));continue}}return a}catch(t){if(t instanceof i&&t.status&&t.status<500)throw t;if(u=t instanceof Error?t:Error("An unknown error occurred"),e<o-1){await new Promise(t=>setTimeout(t,s*Math.pow(2,e)));continue}}throw u||new i("Request failed after multiple retries")}let s=(e,t)=>o(e,{method:"GET",params:t}),n=(e,t)=>o(e,{method:"POST",body:t?JSON.stringify(t):void 0})},1338:(e,t,a)=>{a.d(t,{J:()=>o});var r=a(2115),i=a(1342);function o(){let[e,t]=(0,r.useState)(!1),[a,o]=(0,r.useState)(null),[s,n]=(0,r.useState)(null),l=(0,r.useCallback)(e=>{var t,a;switch(console.log("Received real-time event:",e),o(e),e.type){case"availability.changed":case"vehicle.updated":case"price.updated":(null==(t=e.data)?void 0:t.vehicle_id)&&((0,i.j)(["equipment",e.data.vehicle_id]),(0,i.j)(t=>Array.isArray(t)&&"availability"===t[0]&&t[1]===e.data.vehicle_id,void 0,{revalidate:!0})),(0,i.j)(e=>"equipment"===e||Array.isArray(e)&&"equipment"===e[0]);break;case"vehicle.added":case"vehicle.removed":(0,i.j)(e=>"equipment"===e||Array.isArray(e)&&"equipment"===e[0]),(0,i.j)("featured-equipment");break;case"booking.created":case"booking.confirmed":case"booking.cancelled":(null==(a=e.data)?void 0:a.vehicle_id)&&(0,i.j)(t=>Array.isArray(t)&&"availability"===t[0]&&t[1]===e.data.vehicle_id,void 0,{revalidate:!0});break;case"heartbeat":break;default:console.log("Unhandled event type:",e.type)}},[]);return(0,r.useEffect)(()=>{let e=null,a=null,r=0,i=()=>{try{(e=new EventSource("/api/events")).onopen=()=>{console.log("Connected to real-time updates"),t(!0),n(null),r=0},e.onmessage=e=>{try{let t=JSON.parse(e.data);l(t)}catch(e){console.error("Failed to parse SSE message:",e)}},e.onerror=o=>{console.error("SSE connection error:",o),t(!1),n("Connection lost. Reconnecting..."),e&&e.close(),r++;let s=Math.min(1e3*Math.pow(2,r),3e4);a=setTimeout(()=>{console.log("Reconnecting (attempt ".concat(r,")...")),i()},s)}}catch(e){console.error("Failed to establish SSE connection:",e),n("Failed to connect to real-time updates"),t(!1)}};return i(),()=>{e&&e.close(),a&&clearTimeout(a)}},[l]),{connected:e,lastEvent:a,error:s}}},2431:(e,t,a)=>{a.d(t,{Cy:()=>s});var r=a(5400),i=a(9774);a(8653);let o={revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:3e4};function s(e){let{data:t,error:a,isLoading:s,mutate:n}=(0,r.Ay)(e?["equipment",e]:"equipment",()=>(0,i.pk)(e),{...o,refreshInterval:6e4});return{equipment:(null==t?void 0:t.data)||[],pagination:null==t?void 0:t.pagination,isLoading:s,isError:a,error:a,refresh:n}}},8653:(e,t,a)=>{a.d(t,{q0:()=>i,sH:()=>o});var r=a(125);async function i(e){try{let t=await (0,r.$P)("/api/fleet/availability",e);if(void 0!==t.success)return t;return{success:!0,...t}}catch(t){return console.error("Availability check failed:",t),{success:!1,available:!1,vehicle_id:e.vehicle_id,days:0,estimated_price:0,daily_rate:0,currency:"USD"}}}async function o(e){let t=new Date(e.date_from),a=new Date(e.date_to),i=new Date;if(i.setHours(0,0,0,0),t>=a)throw Error("End date must be after start date");if(t<i)throw Error("Start date cannot be in the past");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer_email))throw Error("Invalid email address");if(!/^[\d\s\-\+\(\)]+$/.test(e.customer_phone))throw Error("Invalid phone number");try{let t=await (0,r.uE)("/api/fleet/booking",{method:"POST",body:JSON.stringify(e),retries:1});if(void 0!==t.success)return t;return{success:!0,...t}}catch(e){if(409===e.status){var o;throw Error((null==(o=e.data)?void 0:o.message)||"This vehicle is not available for the selected dates")}throw e}}},9774:(e,t,a)=>{a.d(t,{cA:()=>s,nB:()=>o,pk:()=>i});var r=a(125);async function i(e){let t=await (0,r.Vg)("/api/fleet/vehicles",e);return t.success&&t.data?t:{success:!1,data:[],pagination:{total:0,limit:(null==e?void 0:e.limit)||20,offset:(null==e?void 0:e.offset)||0,has_more:!1}}}async function o(e){let t=await (0,r.Vg)("/api/fleet/vehicle/".concat(e));if(!t.success||!t.data)throw Error("Equipment not found");return t.data}function s(e){let t;t=e.primary_image&&e.primary_image.startsWith("http")?e.primary_image:"/web/image/fleet.vehicle/".concat(e.id,"/image_1920");let a="Equipment";if(e.category){console.log("Odoo category value:",e.category,"for vehicle:",e.name);let t={skidsteer:"Skid Steers",skid_steer:"Skid Steers","skid steer":"Skid Steers","skid steers":"Skid Steers",excavator:"Excavators",excavators:"Excavators",mini_excavator:"Excavators","mini excavator":"Excavators",trailer:"Trailers",trailers:"Trailers",dump_trailer:"Trailers","dump trailer":"Trailers",equipment_trailer:"Trailers","equipment trailer":"Trailers",loader:"Loaders",loaders:"Loaders",wheel_loader:"Loaders","wheel loader":"Loaders",backhoe:"Loaders",power_tool:"Power Tools","power tool":"Power Tools","power tools":"Power Tools",chainsaw:"Power Tools",generator:"Power Tools",compressor:"Power Tools",attachment:"Attachments",attachments:"Attachments"}[e.category.toLowerCase()];t?a=t:console.warn("Unknown category '".concat(e.category,"' for vehicle '").concat(e.name,"', using default 'Equipment'"))}else if(e.name){let t=e.name.toLowerCase();t.includes("cat")||t.includes("skid")?a="Skid Steers":t.includes("excavator")||t.includes("mini ex")?a="Excavators":t.includes("trailer")?a="Trailers":t.includes("loader")||t.includes("backhoe")?a="Loaders":(t.includes("chainsaw")||t.includes("generator")||t.includes("compressor")||t.includes("tool"))&&(a="Power Tools")}return{id:e.id,name:e.name||"Equipment",category:a,description:"",hourly_rate:Math.round(e.rental_price_daily/8),daily_rate:e.rental_price_daily||0,weekly_rate:e.rental_price_weekly||5*e.rental_price_daily,available:"available"===e.availability_status,image_url:t}}}}]);