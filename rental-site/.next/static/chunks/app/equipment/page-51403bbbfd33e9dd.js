(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{2506:(e,t,a)=>{"use strict";a.d(t,{$P:()=>n,Vg:()=>l});var r=a(636);class s extends Error{constructor(e,t,a){super(e),this.status=t,this.data=a,this.name="ApiError"}}async function i(e,t){let{params:a,retries:i=3,retryDelay:l=1e3,...n}=t||{},o=new URL("".concat("https://lco.axsys.app").concat(e));a&&Object.entries(a).forEach(e=>{let[t,a]=e;null!=a&&o.searchParams.append(t,String(a))});let c={"Content-Type":"application/json",...n.headers||{}},d=r.env.ODOO_API_KEY;d&&(c["X-API-Key"]=d);let u=null;for(let e=0;e<i;e++)try{let t=await fetch(o.toString(),{...n,headers:c}),a=await t.json();if(!t.ok){if(t.status>=400&&t.status<500)throw new s(a.error||"API Error: ".concat(t.statusText),t.status,a);if(t.status>=500&&(u=new s(a.error||"Server Error: ".concat(t.statusText),t.status,a),e<i-1)){await new Promise(t=>setTimeout(t,l*Math.pow(2,e)));continue}}return a}catch(t){if(t instanceof s&&t.status&&t.status<500)throw t;if(u=t instanceof Error?t:Error("An unknown error occurred"),e<i-1){await new Promise(t=>setTimeout(t,l*Math.pow(2,e)));continue}}throw u||new s("Request failed after multiple retries")}let l=(e,t)=>i(e,{method:"GET",params:t}),n=(e,t)=>i(e,{method:"POST",body:t?JSON.stringify(t):void 0})},5979:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(5155),s=a(2115),i=a(1725),l=a(8743),n=a(2619),o=a.n(n),c=a(5239),d=a(5400),u=a(9774);a(8653);let m={revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:3e4};var h=a(1342);function p(){let[e,t]=(0,s.useState)("All"),[a,n]=(0,s.useState)(""),[p,x]=(0,s.useState)("all"),g={listing_type:"rental",limit:50};switch(p){case"budget":g.max_price=99;break;case"mid":g.min_price=100,g.max_price=199;break;case"premium":g.min_price=200}let{equipment:v,isLoading:f,isError:y,refresh:b}=function(e){let{data:t,error:a,isLoading:r,mutate:s}=(0,d.Ay)(e?["equipment",e]:"equipment",()=>(0,u.pk)(e),{...m,refreshInterval:6e4});return{equipment:(null==t?void 0:t.data)||[],pagination:null==t?void 0:t.pagination,isLoading:r,isError:a,error:a,refresh:s}}(g),{connected:w}=function(){let[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(null),n=(0,s.useCallback)(e=>{var t,a;switch(console.log("Received real-time event:",e),r(e),e.type){case"availability.changed":case"vehicle.updated":case"price.updated":(null==(t=e.data)?void 0:t.vehicle_id)&&((0,h.j)(["equipment",e.data.vehicle_id]),(0,h.j)(t=>Array.isArray(t)&&"availability"===t[0]&&t[1]===e.data.vehicle_id,void 0,{revalidate:!0})),(0,h.j)(e=>"equipment"===e||Array.isArray(e)&&"equipment"===e[0]);break;case"vehicle.added":case"vehicle.removed":(0,h.j)(e=>"equipment"===e||Array.isArray(e)&&"equipment"===e[0]),(0,h.j)("featured-equipment");break;case"booking.created":case"booking.confirmed":case"booking.cancelled":(null==(a=e.data)?void 0:a.vehicle_id)&&(0,h.j)(t=>Array.isArray(t)&&"availability"===t[0]&&t[1]===e.data.vehicle_id,void 0,{revalidate:!0});break;case"heartbeat":break;default:console.log("Unhandled event type:",e.type)}},[]);return(0,s.useEffect)(()=>{let e=null,a=null,r=0,s=()=>{try{(e=new EventSource("/api/events")).onopen=()=>{console.log("Connected to real-time updates"),t(!0),l(null),r=0},e.onmessage=e=>{try{let t=JSON.parse(e.data);n(t)}catch(e){console.error("Failed to parse SSE message:",e)}},e.onerror=i=>{console.error("SSE connection error:",i),t(!1),l("Connection lost. Reconnecting..."),e&&e.close(),r++;let n=Math.min(1e3*Math.pow(2,r),3e4);a=setTimeout(()=>{console.log("Reconnecting (attempt ".concat(r,")...")),s()},n)}}catch(e){console.error("Failed to establish SSE connection:",e),l("Failed to connect to real-time updates"),t(!1)}};return s(),()=>{e&&e.close(),a&&clearTimeout(a)}},[n]),{connected:e,lastEvent:a,error:i}}(),j=v.map(u.cA),N=j.filter(t=>{if("All"!==e&&t.category!==e)return!1;if(a&&a.length>0){let e=a.toLowerCase(),r=t.name&&"string"==typeof t.name&&t.name.toLowerCase().includes(e),s=t.description&&"string"==typeof t.description&&t.description.toLowerCase().includes(e);if(!r&&!s)return!1}return!0}),_=["All",...Array.from(new Set(j.map(e=>e.category).filter(e=>e&&"string"==typeof e)))];return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(i.default,{}),(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 text-white",children:(0,r.jsxs)("div",{className:"container mx-auto px-6 py-16",children:[(0,r.jsx)("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Equipment Rental"}),(0,r.jsx)("p",{className:"text-xl opacity-90",children:"Professional-grade outdoor equipment for every season"}),w&&(0,r.jsx)("div",{className:"mt-4 text-sm text-green-200",children:"✓ Live inventory updates enabled"})]})}),(0,r.jsx)("div",{className:"bg-white shadow-md sticky top-0 z-10",children:(0,r.jsxs)("div",{className:"container mx-auto px-6 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,r.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,r.jsx)("input",{type:"text",placeholder:"Search equipment...",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:e=>n(e.target.value)})}),(0,r.jsx)("select",{className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:e,onChange:e=>t(e.target.value),children:_.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsxs)("select",{className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:p,onChange:e=>x(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All Prices"}),(0,r.jsx)("option",{value:"budget",children:"Under $100/day"}),(0,r.jsx)("option",{value:"mid",children:"$100-$199/day"}),(0,r.jsx)("option",{value:"premium",children:"$200+/day"})]}),(0,r.jsx)("button",{onClick:()=>b(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:f,children:f?"Loading...":"Refresh"})]}),(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:["Showing ",N.length," of ",j.length," items"]})]})}),(0,r.jsx)("div",{className:"container mx-auto px-6 py-12",children:y?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:"Failed to load equipment. Please try again."}),(0,r.jsx)("button",{onClick:()=>b(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]}):f?(0,r.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden animate-pulse",children:[(0,r.jsx)("div",{className:"h-48 bg-gray-300"}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-300 rounded mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-4"}),(0,r.jsx)("div",{className:"h-8 bg-gray-300 rounded"})]})]},t))}):0===N.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"No equipment found matching your criteria."}),(0,r.jsx)("button",{onClick:()=>{t("All"),n(""),x("all")},className:"text-blue-600 hover:underline",children:"Clear all filters"})]}):(0,r.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(e=>(0,r.jsx)(o(),{href:"/equipment/".concat(e.id),className:"group",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden transition-transform group-hover:scale-105",children:[(0,r.jsxs)("div",{className:"relative h-48 bg-gray-200",children:[e.image_url?(0,r.jsx)(c.default,{src:e.image_url,alt:e.name,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400",children:(0,r.jsx)("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),!e.available&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsx)("span",{className:"bg-red-600 text-white px-4 py-2 rounded",children:"Currently Unavailable"})})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 group-hover:text-blue-600",children:e.name}),(0,r.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:e.category})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["$",e.daily_rate]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"per day"})]}),(0,r.jsx)("span",{className:"text-blue-600 group-hover:translate-x-1 transition-transform",children:"View Details →"})]})]})]})},e.id))})})]}),(0,r.jsx)(l.A,{})]})}},7457:(e,t,a)=>{Promise.resolve().then(a.bind(a,5979))},8653:(e,t,a)=>{"use strict";a.d(t,{q0:()=>s,sH:()=>i});var r=a(2506);async function s(e){try{let t=await (0,r.$P)("/api/fleet/availability",e);if(void 0!==t.success)return t;return{success:!0,...t}}catch(t){return console.error("Availability check failed:",t),{success:!1,available:!1,vehicle_id:e.vehicle_id,days:0,estimated_price:0,daily_rate:0,currency:"USD"}}}async function i(e){let t=new Date(e.date_from),a=new Date(e.date_to),s=new Date;if(s.setHours(0,0,0,0),t>=a)throw Error("End date must be after start date");if(t<s)throw Error("Start date cannot be in the past");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.customer_email))throw Error("Invalid email address");if(!/^[\d\s\-\+\(\)]+$/.test(e.customer_phone))throw Error("Invalid phone number");try{let t=await (0,r.$P)("/api/fleet/booking",e);if(void 0!==t.success)return t;return{success:!0,...t}}catch(e){if(409===e.status){var i;throw Error((null==(i=e.data)?void 0:i.message)||"This vehicle is not available for the selected dates")}throw e}}},9774:(e,t,a)=>{"use strict";a.d(t,{cA:()=>l,nB:()=>i,pk:()=>s});var r=a(2506);async function s(e){let t=await (0,r.Vg)("/api/fleet/vehicles",e);return t.success&&t.data?t:{success:!1,data:[],pagination:{total:0,limit:(null==e?void 0:e.limit)||20,offset:(null==e?void 0:e.offset)||0,has_more:!1}}}async function i(e){let t=await (0,r.Vg)("/api/fleet/vehicle/".concat(e));if(!t.success||!t.data)throw Error("Equipment not found");return t.data}function l(e){let t;t=e.primary_image?e.primary_image.startsWith("http")?e.primary_image:"https://lco.axsys.app".concat(e.primary_image):"/images/equipment/equipment-hero-600x300.jpg";let a="Equipment";if(e.category)a=({skidsteer:"Skid Steers",skid_steer:"Skid Steers",excavator:"Excavators",mini_excavator:"Excavators",trailer:"Trailers",dump_trailer:"Trailers",equipment_trailer:"Trailers",loader:"Loaders",wheel_loader:"Loaders",backhoe:"Loaders",power_tool:"Power Tools",chainsaw:"Power Tools",generator:"Power Tools",compressor:"Power Tools"})[e.category.toLowerCase()]||"Skid Steers";else if(e.name){let t=e.name.toLowerCase();t.includes("cat")||t.includes("skid")?a="Skid Steers":t.includes("excavator")||t.includes("mini ex")?a="Excavators":t.includes("trailer")?a="Trailers":t.includes("loader")||t.includes("backhoe")?a="Loaders":(t.includes("chainsaw")||t.includes("generator")||t.includes("compressor")||t.includes("tool"))&&(a="Power Tools")}return{id:e.id,name:e.name||"Equipment",category:a,description:"",hourly_rate:Math.round(e.rental_price_daily/8),daily_rate:e.rental_price_daily||0,weekly_rate:e.rental_price_weekly||5*e.rental_price_daily,available:"available"===e.availability_status,image_url:t}}}},e=>{e.O(0,[481,400,67,441,255,358],()=>e(e.s=7457)),_N_E=e.O()}]);